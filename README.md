Παπαγεωργάκης Φώτιος sdi1800145
XXX XXX sdiXXXXXXX


ΕΚΤΕΛΕΣΗ
    Στο direcory build: make heap ή make hash ή make sht

 Για την εκτέλεση, το Makefile στον φάκελο build έχει κατάλληλες εντολές. Με make heap, 
τρέχει η δοκιμαστική main για το heap, με όρισμα records1K.txt, ενώ με make hash τρέχει
η δοκιμαστική main για το hashtable. Για την αλλαγή του δοκιμαστικού αρχείου απαιτείται,
μόνο η αλλαγή της μεταβλητής ARG στο Makefile.


                                            2η ΕΡΓΑΣΙΑ

ΑΛΛΑΓΕΣ ΣΤΗΝ 1η

 Οι αλλαγές που έγιναν απ'την υλοποίηση της πρώτης εργασίας που υποβάλλαμε είναι οι εξής τρεις: 1)o file descriptor δεν αποθηκεύεται στην αρχή του block 0 στην HT_CreateIndex,
αλλά όταν γίνεται η OpenIndex, επιστρέφει σαν file descriptor μέσα στο header_info το αποτέλεσμα της BF_OpenFile. Η προηγούμενη υλοποίηση αν και δούλευε όταν ένα μόνο αρχείο
ήταν ανοιχτό, ήταν λανθασμένη καθώς όταν έχει ταυτόχρονα 2 αρχεία ανοιχτά, θα είχαν λανθασμένα και τα δύο filedescriptor 0. 2)στα ht αρχεία(και τα sht) προσθέσαμε έναν χαρακτήρα
στην αρχή του αρχείου block 0, ο οποίος είναι 'p' για primary index και 's' για secondary index, έτσι ώστε η αντίστοιχες OpenIndex να καταλαβαίνουν αν ανοίγουν αρχείο σωστού τύπου.
3)η hashstatistic είναι σε ξεχωριστό αρχείο και δουλεύει και με hashtable αρχεία και με secondary hash table. Ανάλογα το αρχείο που δίνεται, εμφανίζονται τα στοιχεία αντίστοιχου τύπου.

SHT 
 
 Σε γενικές γραμμές η υλοποίηση του secondary hash table μοιάζει αρκετά με αυτή του πρωτεύοντος hash table. Σαν secondary record σώζουμε μόνο το surname και το blockid, όπως ειπώθηκε στο όνομα,
καθώς μόνο αυτό χρειάζεται σαν πληροφορία. Στην SHT_CreateSecondaryIndex αποθηκεύονται οι απαραίτητες πληροφορίες στο block 0 και δεσμεύονται bucktets blocks, τα οποία είναι απ'το 1 μέχρι το buckets.
Η SHT_OpenSecondaryIndex ελέγχει αν πρόκειται όντως για secondary index, ανοίγει το αρχείο και επιστρέφει το SHT_info με τα απαραίτητα δεδομένα. Η δομή δεσμεύεται δυναμικά στην SHT_OpenSecondaryIndex
και αποδεσμεύεται στην SHT_CloseSecondaryIndex μαζί με το κλείσιμο του BF file. Η SHT_SecondaryInsertEntry, ελέγχει αν υπάρχουν duplicates, δηλαδή secondary records με ίδιο surname και blockid. Αν
υπάρχουν δεν χρειάζεται να ξαναγραφούν, γιατί δεν διαφοροποιούνται κάπως και η SHT_SecondaryGetAllEntries πρέπει να δράσει ανάλογα, δηλαδή να ψάξει ολόκληρο το block για να βρει αν υπάρχουν και 
άλλα records με ίδιο surname. Η λειτουργία της SHT_SecondaryInsertEntry μοιάζει με την HT_InsertEntry.



                                            1η ΕΡΓΑΣΙΑ



HEAP 

 Στην HP_CreateFile δεσμεύεται το block 0 και αποθηκεύονται οι πληροφορίες που δίνονται σαν ορίσματα,
μαζί με έναν pointer για το επόμενο block(-1 αν δεν υπάρχει επόμενο), ο οποίος μπαίνει ως πρώτο στοιχείο,
όπως και σε όλα τα άλλα blocks του αρχείου. Στην HP_OpenFile, ανοίγει το αρχείο, διαβάζονται οι πληροφορίες
που αποθηκεύτηκαν στο block 0 και σώζονται στην μεταβλητή i τύπου HT_info, η οποία έχει δεσμευθεί δυναμικά.
Η HP_InsertEntry, αφού ελέγξει σειριακά ότι δεν υπάρχει ήδη κάποιο record με ίδιο κλειδί, ξεκινάει απ'το block,
στο οποίο δείχνει ο pointer του block 0 και ψάχνει σειριακά, μέχρι να βρει είτε ένα block με κενό χώρο, είτε ένα 
να φτάσει σε γεμάτο block με pointer -1, όπου δεσμεύει ένα ακόμα. Το αν ένα block είναι γεμάτο, κρίνεται από έναν
counter των records που υπάρχουν μέσα σε ένα block, ο οποίος αποθηκεύεται σε κάθε block μετά τον pointer. H 
ΗP_DeleteEntry, ψάχνει σειριακά μέχρι να βρει ένα record με το ζητούμενο κλειδί(id) και όταν το βρει, μειώνει κατά
ένα τον counter του block, έτσι ώστε όταν ψάχνει κάποιος σε αυτό το block να μην φαίνεται ότι υπάρχει. Αν το ζητούμενο
record δεν είναι μόνο του στο block ή τελευταίο, τότε αντιγράφει στην θέση του το τελευταίο record του block, έτσι ώστε
η Insert να γίνεται χωρίς πρόβλημα στο τέλος του block κάθε φορά, χωρίς να ψάχνει αν υπάρχουν κενά στη μέση του block.
H HP_GetAllEntries ψάχνει σειριακά τα blocks μέχρι να βρει το record και όταν το βρει σταματάει, καθώς τα διπλότυπα
απορρίπτονται στην συγκεκριμένη υλοποιήση. H HP_CloseFile αποδεσμεύει την μνήμη που δεσμεύτηκε για το HP_info και κλείνει το αρχείο.

HASHTABLE
 
 Η υλοποίηση επαναχρησιμοποιεί κώδικα απ΄την HEAP με προσαρμογές. Η hash function που επιλέχθηκε είναι μια απλή modulo
hashing συνάρτηση, η οποία κάνει mod πρώτα το κλειδί με έναν πρώτο αριθμό για να είναι πιο αποτελεσματικό και μετά με
το μέγεθος του hashtable. Η HT_CreateIndex δημιουργεί το file, αποθηκεύει στο block 0 τα δεδομένα που δίνονται και 
δεσμεύει buckets blocks που κυμαίνονται από το 1 μέχρι το buckets. H HT_OpenIndex έχει παρόμοια λειτουργία με την 
αντίστοιχη συνάρτηση του heap. Η HT_InsertEntry και η HP_DeleteEntry, "περνάνε" το id απ'την hash function και ανάλογα με το νούμερο που
θα επιστρέψει πηγαίνουν στο αντίστοιχο block για να εισάγουν/διαγράψουν. Αν είναι γεμάτο ακολουθείται μια λογική παρόμοια με το heap.
Παρόμοια λογική έχει και η HT_GetAllEntries. Στην HT_CloseIndex κλείνει το αρχείο και αποδεσμεύεται η μνήμη για το HT_info.
